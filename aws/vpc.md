# VPC

- Virtual Private Cloud
- 독립된 네트워크 환경을 직접 설계하고 인터넷과 연결

# AWS VPC

> Amazon Virtual Private Cloud(VPC)를 사용하면 AWS 클라우드에서 논리적으로 격리된 공간을 프로비저닝하여 고객이 정의하는 가상 네트워크에서 AWS 리소스를 시작할 수 있습니다. IP 주소 범위 선택, 서브넷 생성, 라우팅 테이블 및 네트워크 게이트웨이 구성 등 가상 네트워킹 환경을 완벽하게 제어할 수 있습니다. VPC에서 IPv4와 IPv6를 모두 사용하여 리소스와 애플리케이션에 안전하고 쉽게 액세스할 수 있습니다. 

- 2013 이전에는 EC2-클래식 NW 환경에서 다른 유저들이랑 공유했음. 하지만 이제는 VPC가 필수로 설정되어야 하며, 컴퓨팅 인스턴스 생성 시 기본값 VPC가 만들어짐

## VPC

이름과 CIDR 블록을 필수로 가짐

### CIDR 블록 : IP 범위 지정

- VPC 내에서 생성되는 자원들(EC2 등)은 VPC의 CIDR 범위 내에서 IP를 할당받음
- 하나의 VPC의 최대 크기는 16 (== 2^16개 IP 할당 가능)
- 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 등 사설망 대역을 사용해야 함
- 기본 VPC의 CIDR 블록은 172.31.0.0/16
- VPC를 한 번 만들고 나면 기존 CIDR을 변경하는 것은 불가능하고, 추가만 가능
- 추후에 다수의 VPC를 함께 사용하는 경우 다른 VPC와 CIDR이 겹치면 문제가 발생할 수 있음

## Subnet

VPC 안에서 실제로 리소스가 생성될 수 있는 네트워크

- 서브넷은 실제로 리소스가 생성되는 물리적인 공간인 가용존(Available Zone)과 연결
- 하나의 VPC는 N개의 서브넷을 가질 수 있으며, 하나의 서브넷은 하나의 가용존에 연결
- 일반적으로 사용할 수 있는 가용존을 고려해서 적절한 크기의 서브넷들을 가용존 수만큼 생성해서 사용
- 서브넷의 넷마스크 범위는 `/16`~`/28`을 사용할 수 있으며, VPC CIDR 블럭 범위에 속하는 CIDR 블럭을 지정할 수 있음
- 기본 VPC에서는 가용존 갯수만큼 넷마스크 20의 서브넷들을 자동적으로 생성

![image](https://user-images.githubusercontent.com/43198798/141067920-7ae30223-9a67-412d-9c69-f3cd922d0667.png)

서브넷 트래픽이 `인터넷 게이트웨이`로 라우팅되는 경우 해당 서브넷을 `퍼블릭 서브넷`이라고 합니다. 이 그림에서는 서브넷 1이 퍼블릭 서브넷입니다. 퍼블릭 서브넷의 인스턴스가 IPv4를 통해 인터넷과 통신할 수 있게 하려면 인스턴스에 퍼블릭 IPv4 주소 또는 탄력적 IP 주소(IPv4)가 있어야 합니다. 퍼블릭 IPv4 주소에 대한 자세한 내용은 퍼블릭 IPv4 주소 단원을 참조하십시오. 퍼블릭 서브넷의 인스턴스가 IPv6를 통해 인터넷과 통신할 수 있으려면 인스턴스에 퍼블릭 IPv6 주소가 있어야 합니다.

인터넷 게이트웨이로 라우팅되지 않는 서브넷을 프라이빗 서브넷이라고 합니다. 이 그림에서는 서브넷 2가 프라이빗 서브넷입니다.

서브넷이 인터넷 게이트웨이에 이르는 경로를 갖고 있지 않지만 그 트래픽이 Site-to-Site VPN 연결을 위한 가상 프라이빗 게이트웨이로 라우팅되는 경우, 이 서브넷을 VPN 전용 서브넷이라고 합니다. 이 그림에서는 서브넷 3이 VPN 전용 서브넷입니다. 현재 Site-to-Site VPN 연결을 통한 IPv6 트래픽은 지원하지 않습니다.

## Route Table

서브넷의 outbound traffic에 대한 routing 경로를 설정하는 것

## Internet Gateway

서브넷을 인터넷에 연결하기 위해서는 인터넷 게이트웨이와 연결하고, 서브넷에 퍼블릭 IP를 부여하고, 이 IP와 인터넷 게이트웨이 라우팅 설정을 라우팅 테이블에 넣어야 함

## DHCP options set

TCP/IP 네트워크 상의 호스트로 설정 정보를 전달하는 DHCP 표준으로, 일반적으로 VPC 생성 시 만들어지는 DHCP 옵션셋을 그대로 사용

+) VPC 안에 생성되는 EC2에게 자동으로 IP를 할당해주기 위해서 사용하는 DHCP 서비스입니다.

## Network ACL

NW 트래픽을 제어하는 가상 방화벽

- 서브넷 단위로 설정하며, 다수의 서브넷에서 재사용 가능
- 시큐리티 그룹은 인스턴스 단위 방화벽으로, 인스턴스의 앞단에서 트래픽을 제어하는 가상 방화벽인 반면, NW ACL은 서브넷 앞단에서 트래픽을 제어하는 역할

